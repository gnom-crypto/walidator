<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockMaster Pro - Система управления складом</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #2c6fbb;
            --primary-dark: #1e5499;
            --primary-light: #4a8bd6;
            --secondary: #5a6268;
            --success: #28a745;
            --error: #dc3545;
            --warning: #ffc107;
            --light: #f8f9fa;
            --dark: #343a40;
            --border: #dee2e6;
            --gray: #e9ecef;
        }
        
        body {
            background: linear-gradient(135deg, #e6f2ff, #cce5ff);
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 95vh;
        }
        
        /* Header */
        .header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 22px 35px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 18px;
        }
        
        .logo-icon {
            font-size: 36px;
            color: white;
            background: var(--primary-light);
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .header-text {
            display: flex;
            flex-direction: column;
        }
        
        .header h1 {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .header-subtitle {
            font-size: 15px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        /* Control buttons */
        .control-buttons {
            display: flex;
            gap: 15px;
        }
        
        .control-button {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            font-size: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .control-button:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.08);
        }
        
        /* Main content */
        .content {
            display: grid;
            grid-template-columns: 320px 1fr;
            flex-grow: 1;
            overflow: hidden;
            background: #f0f6ff;
        }
        
        /* Left panel - actions */
        .left-panel {
            background: white;
            padding: 28px;
            display: flex;
            flex-direction: column;
            gap: 28px;
            overflow-y: auto;
            border-right: 1px solid var(--border);
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.05);
        }
        
        .panel-section {
            background: white;
            border-radius: 12px;
            padding: 22px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.06);
            position: relative;
            border: 1px solid var(--border);
        }
        
        .panel-title {
            font-weight: 700;
            margin-bottom: 22px;
            color: var(--primary);
            font-size: 22px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .panel-title i {
            font-size: 24px;
            color: var(--primary);
        }
        
        /* Form elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 16px;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: var(--light);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(44, 111, 187, 0.2);
        }
        
        /* Buttons */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 28px;
            font-size: 17px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            width: 100%;
            margin: 15px 0;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 5px 18px rgba(44, 111, 187, 0.35);
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            transform: translateY(-3px);
            box-shadow: 0 8px 22px rgba(44, 111, 187, 0.45);
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--success), #218838);
            color: white;
            box-shadow: 0 5px 18px rgba(40, 167, 69, 0.35);
        }
        
        .btn-success:hover {
            background: linear-gradient(to right, #218838, var(--success));
            transform: translateY(-3px);
            box-shadow: 0 8px 22px rgba(40, 167, 69, 0.45);
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--error), #bd2130);
            color: white;
            box-shadow: 0 5px 18px rgba(220, 53, 69, 0.35);
        }
        
        .btn-danger:hover {
            background: linear-gradient(to right, #bd2130, var(--error));
            transform: translateY(-3px);
            box-shadow: 0 8px 22px rgba(220, 53, 69, 0.45);
        }
        
        .btn-warning {
            background: linear-gradient(to right, var(--warning), #e0a800);
            color: var(--dark);
            box-shadow: 0 5px 18px rgba(255, 193, 7, 0.35);
        }
        
        .btn-warning:hover {
            background: linear-gradient(to right, #e0a800, var(--warning));
            transform: translateY(-3px);
            box-shadow: 0 8px 22px rgba(255, 193, 7, 0.45);
        }
        
        .btn i {
            font-size: 20px;
        }
        
        /* Right panel - display */
        .right-panel {
            padding: 28px;
            background: white;
            display: flex;
            flex-direction: column;
            gap: 28px;
            overflow-y: auto;
        }
        
        .tab-container {
            display: flex;
            background: var(--light);
            border-radius: 10px;
            padding: 6px;
            margin-bottom: 25px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }
        
        .tab {
            padding: 14px 24px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
            color: var(--secondary);
            font-size: 16px;
        }
        
        .tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Product grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            padding: 22px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        
        .product-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
            border-color: var(--primary-light);
        }
        
        .product-card h3 {
            color: var(--primary);
            margin-bottom: 18px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }
        
        .product-card h3 i {
            color: var(--primary);
        }
        
        .product-card p {
            margin: 8px 0;
            color: var(--dark);
            font-size: 16px;
        }
        
        .barcode-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 18px 0;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: white;
        }
        
        .barcode-number {
            font-family: monospace;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--dark);
            letter-spacing: 1px;
        }
        
        .cell-info {
            display: flex;
            justify-content: space-between;
            background: var(--light);
            padding: 14px;
            border-radius: 10px;
            margin-top: 18px;
            font-weight: 600;
            border: 1px solid var(--border);
            font-size: 17px;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .action-btn.edit {
            background: #e6f2ff;
            color: var(--primary);
        }
        
        .action-btn.delete {
            background: #ffe6e6;
            color: var(--error);
        }
        
        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* Print section */
        .print-section {
            padding: 22px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
        }
        
        .print-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }
        
        .print-item {
            background: white;
            padding: 18px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border);
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .print-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 7px 18px rgba(0,0,0,0.12);
        }
        
        .print-item h4 {
            margin: 12px 0;
            color: var(--primary);
            font-size: 18px;
            font-weight: 600;
        }
        
        .barcode-wrapper {
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin: 12px auto;
            max-width: 100%;
            overflow: hidden;
        }
        
        /* Footer */
        .footer {
            background: white;
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--border);
            font-size: 15px;
            color: var(--secondary);
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .status-bar {
            display: flex;
            gap: 25px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
        }
        
        .status-item i {
            color: var(--primary);
        }
        
        /* Reset button */
        .reset-button {
            background: transparent;
            color: var(--error);
            border: 1px solid var(--error);
            border-radius: 8px;
            padding: 8px 18px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .reset-button:hover {
            background: var(--error);
            color: white;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.35);
            width: 90%;
            max-width: 550px;
            text-align: center;
            position: relative;
            animation: modalIn 0.5s ease-out;
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: translateY(-60px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-title {
            font-size: 26px;
            color: var(--primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 700;
        }
        
        .modal-input {
            width: 100%;
            padding: 16px;
            margin: 20px 0;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 17px;
            text-align: center;
            outline: none;
            transition: all 0.3s;
            background: var(--light);
        }
        
        .modal-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(44, 111, 187, 0.25);
        }
        
        .modal-buttons {
            display: flex;
            gap: 18px;
            margin-top: 25px;
        }
        
        .modal-button {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            border: none;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-button.confirm {
            background: var(--success);
            color: white;
        }
        
        .modal-button.confirm:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .modal-button.cancel {
            background: var(--light);
            color: var(--dark);
            border: 1px solid var(--border);
        }
        
        .modal-button.cancel:hover {
            background: #e2e6ea;
            transform: translateY(-2px);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .left-panel {
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
        }
        
        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: 1fr;
            }
            
            .print-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .logo {
                justify-content: center;
            }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 50px 25px;
            color: var(--secondary);
            grid-column: 1 / -1;
        }
        
        .empty-state i {
            font-size: 70px;
            color: #d1d9e0;
            margin-bottom: 25px;
            opacity: 0.7;
        }
        
        .empty-state h3 {
            font-size: 26px;
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        .empty-state p {
            font-size: 17px;
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        /* Cell status */
        .cell-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .status-active {
            background: #e6ffed;
            color: var(--success);
        }
        
        .status-issued {
            background: #ffe6e6;
            color: var(--error);
        }
        
        /* Animation */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-warehouse"></i>
                </div>
                <div class="header-text">
                    <h1>StockMaster Pro</h1>
                    <div class="header-subtitle">Профессиональная система управления складом</div>
                </div>
            </div>
            <div class="control-buttons">
                <div class="control-button">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <div class="control-button">
                    <i class="fas fa-cog"></i>
                </div>
            </div>
        </div>
        
        <div class="content">
            <div class="left-panel">
                <div class="panel-section">
                    <div class="panel-title">
                        <i class="fas fa-boxes"></i>
                        Управление товарами
                    </div>
                    
                    <div class="form-group">
                        <label for="cellSelector"><i class="fas fa-cube"></i> Выберите ячейку</label>
                        <select id="cellSelector" class="form-control">
                            <option value="P1">Ячейка P1</option>
                            <option value="P2">Ячейка P2</option>
                            <option value="P3">Ячейка P3</option>
                            <option value="P4">Ячейка P4</option>
                            <option value="P5">Ячейка P5</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" id="addProductBtn">
                        <i class="fas fa-plus-circle"></i>
                        Добавить товар
                    </button>
                    <button class="btn btn-success" id="generateBarcodeBtn">
                        <i class="fas fa-barcode"></i>
                        Создать штрих-код для ячейки
                    </button>
                    <button class="btn btn-warning" id="viewProductsBtn">
                        <i class="fas fa-search"></i>
                        Просмотреть товары в ячейке
                    </button>
                </div>
                
                <div class="panel-section">
                    <div class="panel-title">
                        <i class="fas fa-chart-bar"></i>
                        Статус системы
                    </div>
                    <div class="status-item">
                        <i class="fas fa-box"></i>
                        <span>Товаров: <strong id="itemsCount">0</strong></span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-cubes"></i>
                        <span>Ячеек: <strong id="cellsCount">0</strong></span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-barcode"></i>
                        <span>Штрих-кодов: <strong id="barcodesCount">0</strong></span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-history"></i>
                        <span>Последнее действие: <strong id="lastAction">Нет</strong></span>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="panel-title">
                        <i class="fas fa-truck-loading"></i>
                        Выдача товаров
                    </div>
                    <p style="margin-bottom: 18px; color: var(--secondary);">Для выдачи товаров отсканируйте штрих-код ячейки:</p>
                    <button class="btn btn-primary" id="issueItemsBtn">
                        <i class="fas fa-camera"></i>
                        Сканировать штрих-код
                    </button>
                    <button class="btn btn-danger" id="resetCellBtn">
                        <i class="fas fa-trash-alt"></i>
                        Очистить ячейку
                    </button>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="tab-container">
                    <div class="tab active" data-tab="products">Товары в системе</div>
                    <div class="tab" data-tab="codes">Штрих-коды для печати</div>
                    <div class="tab" data-tab="cells">Статус ячеек</div>
                </div>
                
                <div id="productsTab" class="tab-content active">
                    <div class="panel-section">
                        <div class="product-grid" id="productGrid">
                            <div class="empty-state">
                                <i class="fas fa-box-open"></i>
                                <h3>Нет товаров</h3>
                                <p>Добавьте товары, нажав кнопку "Добавить товар"</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="codesTab" class="tab-content">
                    <div class="print-section">
                        <div class="print-grid" id="printGrid">
                            <div class="empty-state">
                                <i class="fas fa-barcode"></i>
                                <h3>Нет штрих-кодов</h3>
                                <p>Создайте штрих-коды для ячеек, нажав кнопку "Создать штрих-код"</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="cellsTab" class="tab-content">
                    <div class="panel-section">
                        <h2 style="color: var(--primary); margin-bottom: 25px; display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-warehouse"></i>
                            Статус ячеек хранения
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px;">
                            <div class="cell-card" style="background: #e8f4ff; padding: 25px; border-radius: 12px; border: 1px solid var(--border);">
                                <h3 style="display: flex; align-items: center; gap: 12px; color: var(--primary);">
                                    <i class="fas fa-cube"></i> Ячейка P1
                                </h3>
                                <p style="margin: 12px 0;"><strong>Товаров:</strong> <span id="cellP1Count">0</span></p>
                                <p><strong>Статус:</strong> <span id="cellP1Status" class="cell-status status-active">Пустая</span></p>
                                <button class="action-btn edit" onclick="viewCellProducts('P1')" style="margin-top: 15px;">
                                    <i class="fas fa-eye"></i> Просмотреть
                                </button>
                            </div>
                            <div class="cell-card" style="background: #e8f4ff; padding: 25px; border-radius: 12px; border: 1px solid var(--border);">
                                <h3 style="display: flex; align-items: center; gap: 12px; color: var(--primary);">
                                    <i class="fas fa-cube"></i> Ячейка P2
                                </h3>
                                <p style="margin: 12px 0;"><strong>Товаров:</strong> <span id="cellP2Count">0</span></p>
                                <p><strong>Статус:</strong> <span id="cellP2Status" class="cell-status status-active">Пустая</span></p>
                                <button class="action-btn edit" onclick="viewCellProducts('P2')" style="margin-top: 15px;">
                                    <i class="fas fa-eye"></i> Просмотреть
                                </button>
                            </div>
                            <div class="cell-card" style="background: #e8f4ff; padding: 25px; border-radius: 12px; border: 1px solid var(--border);">
                                <h3 style="display: flex; align-items: center; gap: 12px; color: var(--primary);">
                                    <i class="fas fa-cube"></i> Ячейка P3
                                </h3>
                                <p style="margin: 12px 0;"><strong>Товаров:</strong> <span id="cellP3Count">0</span></p>
                                <p><strong>Статус:</strong> <span id="cellP3Status" class="cell-status status-active">Пустая</span></p>
                                <button class="action-btn edit" onclick="viewCellProducts('P3')" style="margin-top: 15px;">
                                    <i class="fas fa-eye"></i> Просмотреть
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div class="status-bar">
                <div class="status-item">
                    <i class="fas fa-database"></i>
                    <span>База данных: <span id="dbStatus">Активна</span></span>
                </div>
                <div class="status-item">
                    <i class="fas fa-microchip"></i>
                    <span>Загрузка ЦП: <span id="cpuStatus">12%</span></span>
                </div>
            </div>
            <div>
                <button class="reset-button" id="resetBtn">
                    <i class="fas fa-redo"></i>
                    Сброс системы
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal" id="productNameModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-tag"></i>
                Введите название товара
            </div>
            <input type="text" class="modal-input" id="productNameInput" placeholder="Например: Ноутбук Dell XPS">
            <div class="modal-buttons">
                <button class="modal-button cancel" id="cancelProductBtn">Отмена</button>
                <button class="modal-button confirm" id="confirmProductBtn">Добавить</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-lock"></i>
                Подтверждение сброса
            </div>
            <p style="margin-bottom: 20px; color: var(--dark);">Введите пароль для сброса системы:</p>
            <input type="password" class="modal-input" id="passwordInput" placeholder="Введите пароль 7533">
            <div class="modal-buttons">
                <button class="modal-button cancel" id="cancelResetBtn">Отмена</button>
                <button class="modal-button confirm" id="confirmResetBtn">Сбросить</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="scanModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-camera"></i>
                Сканирование штрих-кода
            </div>
            <p style="margin-bottom: 20px; color: var(--dark);">Введите штрих-код ячейки для выдачи товаров:</p>
            <input type="text" class="modal-input" id="scanInput" placeholder="Отсканируйте штрих-код">
            <div class="modal-buttons">
                <button class="modal-button cancel" id="cancelScanBtn">Отмена</button>
                <button class="modal-button confirm" id="confirmScanBtn">Подтвердить</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="viewProductsModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-boxes"></i>
                Товары в ячейке <span id="cellName"></span>
            </div>
            <div id="cellProductsList" style="max-height: 400px; overflow-y: auto; text-align: left; margin: 20px 0; padding: 15px; background: var(--light); border-radius: 10px; border: 1px solid var(--border);"></div>
            <div class="modal-buttons">
                <button class="modal-button cancel" id="closeViewModalBtn">Закрыть</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let products = [];
        let barcodes = [];
        let currentCell = 'P1';
        
        // DOM Elements
        const productGrid = document.getElementById('productGrid');
        const printGrid = document.getElementById('printGrid');
        const itemsCount = document.getElementById('itemsCount');
        const cellsCount = document.getElementById('cellsCount');
        const barcodesCount = document.getElementById('barcodesCount');
        const lastAction = document.getElementById('lastAction');
        const cellSelector = document.getElementById('cellSelector');
        const productNameModal = document.getElementById('productNameModal');
        const passwordModal = document.getElementById('passwordModal');
        const scanModal = document.getElementById('scanModal');
        const viewProductsModal = document.getElementById('viewProductsModal');
        const productNameInput = document.getElementById('productNameInput');
        const scanInput = document.getElementById('scanInput');
        const cellProductsList = document.getElementById('cellProductsList');
        const cellNameSpan = document.getElementById('cellName');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load data from localStorage
            loadData();
            
            // Set up tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab + 'Tab').classList.add('active');
                });
            });
            
            // Event listeners
            document.getElementById('addProductBtn').addEventListener('click', showProductNameModal);
            document.getElementById('generateBarcodeBtn').addEventListener('click', generateBarcodeForCell);
            document.getElementById('viewProductsBtn').addEventListener('click', viewCurrentCellProducts);
            document.getElementById('issueItemsBtn').addEventListener('click', showScanModal);
            document.getElementById('resetCellBtn').addEventListener('click', resetCurrentCell);
            document.getElementById('resetBtn').addEventListener('click', showPasswordModal);
            document.getElementById('cancelProductBtn').addEventListener('click', closeProductNameModal);
            document.getElementById('confirmProductBtn').addEventListener('click', addProductWithName);
            document.getElementById('cancelResetBtn').addEventListener('click', closePasswordModal);
            document.getElementById('confirmResetBtn').addEventListener('click', resetSystem);
            document.getElementById('cancelScanBtn').addEventListener('click', closeScanModal);
            document.getElementById('confirmScanBtn').addEventListener('click', processScan);
            document.getElementById('closeViewModalBtn').addEventListener('click', () => {
                viewProductsModal.style.display = 'none';
            });
            
            // Cell selector
            cellSelector.addEventListener('change', (e) => {
                currentCell = e.target.value;
                updateLastAction(`Выбрана ячейка: ${currentCell}`);
            });
            
            // Simulate system stats
            setInterval(() => {
                document.getElementById('cpuStatus').textContent = 
                    Math.floor(Math.random() * 20) + 5 + '%';
            }, 3000);
            
            // Update cell status
            updateCellStatus();
        });
        
        // Load data from localStorage
        function loadData() {
            const storedProducts = localStorage.getItem('products');
            const storedBarcodes = localStorage.getItem('barcodes');
            
            if (storedProducts) {
                products = JSON.parse(storedProducts);
            }
            
            if (storedBarcodes) {
                barcodes = JSON.parse(storedBarcodes);
            }
            
            updateProductDisplay();
            updateBarcodeDisplay();
            updateSystemStats();
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('barcodes', JSON.stringify(barcodes));
        }
        
        // Show product name modal
        function showProductNameModal() {
            productNameInput.value = '';
            productNameInput.focus();
            productNameModal.style.display = 'flex';
        }
        
        // Close product name modal
        function closeProductNameModal() {
            productNameModal.style.display = 'none';
        }
        
        // Add product with custom name
        function addProductWithName() {
            const productName = productNameInput.value.trim();
            
            if (!productName) {
                alert('Пожалуйста, введите название товара');
                return;
            }
            
            addProduct(productName);
            closeProductNameModal();
        }
        
        // Add product
        function addProduct(name) {
            const productId = 'PRD-' + Date.now().toString().slice(-6);
            const barcode = 'BC-' + Math.floor(100000 + Math.random() * 900000);
            
            // Create product
            const product = {
                id: productId,
                name: name,
                barcode: barcode,
                cell: currentCell,
                status: 'active',
                date: new Date().toISOString()
            };
            
            products.push(product);
            saveData();
            updateProductDisplay();
            updateSystemStats();
            updateCellStatus();
            
            updateLastAction(`Товар "${name}" добавлен в ячейку ${currentCell}`);
            
            // Auto switch to products tab
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('.tab[data-tab="products"]').classList.add('active');
            document.getElementById('productsTab').classList.add('active');
        }
        
        // Generate barcode for cell
        function generateBarcodeForCell() {
            // Find products in current cell
            const cellProducts = products.filter(p => p.cell === currentCell && p.status === 'active');
            
            if (cellProducts.length === 0) {
                alert(`В ячейке ${currentCell} нет активных товаров`);
                return;
            }
            
            // Create barcode content
            const barcodeContent = `CELL-${currentCell}-${Date.now().toString().slice(-6)}`;
            
            // Create barcode object
            const barcode = {
                id: 'BC-' + Date.now().toString(),
                cell: currentCell,
                content: barcodeContent,
                products: cellProducts.map(p => p.id),
                date: new Date().toISOString()
            };
            
            barcodes.push(barcode);
            saveData();
            updateBarcodeDisplay();
            
            // Create barcode element
            createBarcodeElement(barcode);
            
            updateLastAction(`Создан штрих-код для ячейки: ${currentCell}`);
        }
        
        // Create barcode element
        function createBarcodeElement(barcode) {
            const printItem = document.createElement('div');
            printItem.className = 'print-item';
            printItem.id = `barcode-${barcode.id}`;
            
            const label = document.createElement('h4');
            label.textContent = `Ячейка ${barcode.cell}`;
            printItem.appendChild(label);
            
            const dateLabel = document.createElement('p');
            dateLabel.textContent = new Date(barcode.date).toLocaleDateString();
            dateLabel.style.color = '#6c757d';
            dateLabel.style.fontSize = '15px';
            printItem.appendChild(dateLabel);
            
            const countLabel = document.createElement('p');
            countLabel.textContent = `Товаров: ${barcode.products.length}`;
            countLabel.style.fontWeight = '600';
            countLabel.style.marginBottom = '15px';
            printItem.appendChild(countLabel);
            
            const barcodeWrapper = document.createElement('div');
            barcodeWrapper.className = 'barcode-wrapper';
            printItem.appendChild(barcodeWrapper);
            
            const canvas = document.createElement('canvas');
            barcodeWrapper.appendChild(canvas);
            
            printGrid.appendChild(printItem);
            
            // Generate barcode
            JsBarcode(canvas, barcode.content, {
                format: "CODE128",
                displayValue: true,
                fontSize: 14,
                height: 50,
                margin: 10,
                text: barcode.content,
                textMargin: 5
            });
            
            // Switch to codes tab
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('.tab[data-tab="codes"]').classList.add('active');
            document.getElementById('codesTab').classList.add('active');
        }
        
        // Show scan modal
        function showScanModal() {
            scanInput.value = '';
            scanInput.focus();
            scanModal.style.display = 'flex';
        }
        
        // Close scan modal
        function closeScanModal() {
            scanModal.style.display = 'none';
        }
        
        // Process scan
        function processScan() {
            const scanValue = scanInput.value.trim();
            
            if (!scanValue) {
                alert('Пожалуйста, введите или отсканируйте штрих-код');
                return;
            }
            
            // Find barcode
            const barcode = barcodes.find(b => b.content === scanValue);
            
            if (!barcode) {
                alert('Штрих-код не найден в системе');
                return;
            }
            
            // Find products for this barcode
            const productsToIssue = products.filter(p => 
                barcode.products.includes(p.id) && p.status === 'active');
                
            if (productsToIssue.length === 0) {
                alert('Нет активных товаров для выдачи в этой ячейке');
                closeScanModal();
                return;
            }
            
            // Issue products
            productsToIssue.forEach(product => {
                product.status = 'issued';
            });
            
            saveData();
            updateProductDisplay();
            updateSystemStats();
            updateCellStatus();
            
            closeScanModal();
            
            alert(`Товары в ячейке ${barcode.cell} успешно выданы!`);
            updateLastAction(`Товары в ячейке ${barcode.cell} выданы`);
        }
        
        // View products in current cell
        function viewCurrentCellProducts() {
            viewCellProducts(currentCell);
        }
        
        // View products in specific cell
        function viewCellProducts(cell) {
            const cellProducts = products.filter(p => p.cell === cell);
            
            if (cellProducts.length === 0) {
                alert(`В ячейке ${cell} нет товаров`);
                return;
            }
            
            cellNameSpan.textContent = cell;
            cellProductsList.innerHTML = '';
            
            cellProducts.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'cell-product-item';
                productItem.style.padding = '12px';
                productItem.style.borderBottom = '1px solid var(--border)';
                productItem.style.display = 'flex';
                productItem.style.justifyContent = 'space-between';
                productItem.style.alignItems = 'center';
                
                productItem.innerHTML = `
                    <div>
                        <strong>${product.name}</strong>
                        <div>ID: ${product.id}</div>
                        <div>Штрих-код: ${product.barcode}</div>
                    </div>
                    <span class="cell-status ${product.status === 'active' ? 'status-active' : 'status-issued'}">
                        ${product.status === 'active' ? 'Активен' : 'Выдан'}
                    </span>
                `;
                
                cellProductsList.appendChild(productItem);
            });
            
            viewProductsModal.style.display = 'flex';
        }
        
        // Reset current cell
        function resetCurrentCell() {
            if (confirm(`Вы уверены, что хотите очистить ячейку ${currentCell}? Все товары будут удалены.`)) {
                // Remove products from current cell
                products = products.filter(p => p.cell !== currentCell);
                saveData();
                updateProductDisplay();
                updateSystemStats();
                updateCellStatus();
                
                alert(`Ячейка ${currentCell} успешно очищена!`);
                updateLastAction(`Ячейка ${currentCell} очищена`);
            }
        }
        
        // Show password modal
        function showPasswordModal() {
            document.getElementById('passwordInput').value = '';
            passwordModal.style.display = 'flex';
        }
        
        // Close password modal
        function closePasswordModal() {
            passwordModal.style.display = 'none';
        }
        
        // Reset system
        function resetSystem() {
            const password = document.getElementById('passwordInput').value;
            
            if (password !== '7533') {
                alert('Неверный пароль! Попробуйте еще раз.');
                return;
            }
            
            closePasswordModal();
            
            // Clear localStorage
            localStorage.removeItem('products');
            localStorage.removeItem('barcodes');
            
            // Reset arrays
            products = [];
            barcodes = [];
            
            // Update UI
            updateProductDisplay();
            updateBarcodeDisplay();
            updateSystemStats();
            updateCellStatus();
            
            alert('Система успешно сброшена!');
            updateLastAction('Система сброшена');
        }
        
        // Update product display
        function updateProductDisplay() {
            productGrid.innerHTML = '';
            
            const activeProducts = products.filter(p => p.status === 'active');
            
            if (activeProducts.length === 0) {
                productGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <h3>Нет активных товаров</h3>
                        <p>Добавьте товары, нажав кнопку "Добавить товар"</p>
                    </div>
                `;
                return;
            }
            
            activeProducts.forEach((product, index) => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <h3><i class="fas fa-tag"></i> ${product.name}</h3>
                    <p><strong>ID:</strong> ${product.id}</p>
                    <p><strong>Штрих-код:</strong> ${product.barcode}</p>
                    <div class="cell-info">
                        <span><i class="fas fa-cube"></i> Ячейка:</span>
                        <span>${product.cell}</span>
                    </div>
                    <div class="barcode-container">
                        <div class="barcode-number">${product.barcode}</div>
                        <div id="barcode-${index}"></div>
                    </div>
                    <div class="product-actions">
                        <button class="action-btn edit" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i> Изменить
                        </button>
                        <button class="action-btn delete" onclick="deleteProduct('${product.id}')">
                            <i class="fas fa-trash-alt"></i> Удалить
                        </button>
                    </div>
                `;
                productGrid.appendChild(productCard);
                
                // Generate barcode
                setTimeout(() => {
                    JsBarcode(`#barcode-${index}`, product.barcode, {
                        format: "CODE128",
                        displayValue: false,
                        fontSize: 14,
                        height: 50,
                        background: "transparent",
                        margin: 5
                    });
                }, 100);
            });
        }
        
        // Edit product
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const newName = prompt('Введите новое название товара:', product.name);
            if (newName && newName.trim() !== '') {
                product.name = newName.trim();
                saveData();
                updateProductDisplay();
                updateLastAction(`Товар "${product.name}" изменен`);
            }
        }
        
        // Delete product
        function deleteProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            if (confirm(`Вы уверены, что хотите удалить товар "${product.name}"?`)) {
                products = products.filter(p => p.id !== productId);
                saveData();
                updateProductDisplay();
                updateSystemStats();
                updateCellStatus();
                updateLastAction(`Товар "${product.name}" удален`);
            }
        }
        
        // Update barcode display
        function updateBarcodeDisplay() {
            printGrid.innerHTML = '';
            
            if (barcodes.length === 0) {
                printGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-barcode"></i>
                        <h3>Нет штрих-кодов</h3>
                        <p>Создайте штрих-коды для ячеек, нажав кнопку "Создать штрих-код"</p>
                    </div>
                `;
                return;
            }
            
            barcodes.forEach(barcode => {
                createBarcodeElement(barcode);
            });
        }
        
        // Update system stats
        function updateSystemStats() {
            const activeProducts = products.filter(p => p.status === 'active');
            itemsCount.textContent = activeProducts.length;
            barcodesCount.textContent = barcodes.length;
            
            // Count unique cells with active products
            const uniqueCells = new Set(activeProducts.map(p => p.cell));
            cellsCount.textContent = uniqueCells.size;
        }
        
        // Update cell status
        function updateCellStatus() {
            const cells = ['P1', 'P2', 'P3'];
            
            cells.forEach(cell => {
                const count = products.filter(p => p.cell === cell && p.status === 'active').length;
                document.getElementById(`cell${cell}Count`).textContent = count;
                
                const statusElement = document.getElementById(`cell${cell}Status`);
                if (count > 0) {
                    statusElement.textContent = 'Заполнена';
                    statusElement.className = 'cell-status status-active';
                } else {
                    statusElement.textContent = 'Пустая';
                    statusElement.className = 'cell-status status-issued';
                }
            });
        }
        
        // Update last action
        function updateLastAction(text) {
            lastAction.textContent = text;
        }
    </script>
</body>
</html>
